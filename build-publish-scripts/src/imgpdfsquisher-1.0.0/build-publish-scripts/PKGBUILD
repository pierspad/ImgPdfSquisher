# Maintainer: pierspad
pkgname=imgpdfsquisher
pkgver=1.0.0
pkgrel=1
pkgdesc="A Python GUI application for reducing the filesize of PDF with high resolution images"
arch=('any')
url="https://github.com/pierspad/imgpdfsquisher"
license=('MIT')

# runtime deps
depends=(
  'python'
  'poppler'
  'python-pillow'
  'python-reportlab'
  'python-charset-normalizer'
  'pyside6'
  'python-pdf2image'   # su AUR su molte installazioni
)

makedepends=()         # nessuna build di wheel
optdepends=('python-pip: per eventuali plugin/estensioni')

# tarball ufficiale da GitHub (tag vX.Y.Z)
source=("$pkgname-$pkgver.tar.gz::https://github.com/pierspad/imgpdfsquisher/archive/v$pkgver.tar.gz")
sha256sums=('SKIP')    # usa `updpkgsums` per fissare l'hash esatto

prepare() {
  cd "$srcdir/$pkgname-$pkgver"
}

build() {
  :
}

check() {
  :
}

package() {
  cd "$srcdir/$pkgname-$pkgver"

  # 1) Install app sorgente
  install -d "$pkgdir/usr/lib/$pkgname"
  # Copia tutto tranne le cartelle/artefatti di build locali
  cp -r ./* "$pkgdir/usr/lib/$pkgname/"
  rm -rf "$pkgdir/usr/lib/$pkgname/build-publish-scripts/src" \
         "$pkgdir/usr/lib/$pkgname/build-publish-scripts/pkg"

  # 2) Wrapper CLI in PATH
  install -d "$pkgdir/usr/bin"
  cat > "$pkgdir/usr/bin/$pkgname" <<'EOF'
#!/usr/bin/env bash
# Avvia l'app GUI
exec python /usr/lib/imgpdfsquisher/gui_app.py "$@"
EOF
  chmod 755 "$pkgdir/usr/bin/$pkgname"

  # 3) Desktop entry
  install -d "$pkgdir/usr/share/applications"
  install -m 644 "imgpdfsquisher.desktop" "$pkgdir/usr/share/applications/imgpdfsquisher.desktop"

  # 4) Icona (usa il PNG del repo: assets/logo/logo.png)
  #    La chiave Ã¨ installarla con nome 'imgpdfsquisher.png' nel tema hicolor.
  install -d "$pkgdir/usr/share/icons/hicolor/256x256/apps"
  install -m 644 "assets/logo/logo.png" "$pkgdir/usr/share/icons/hicolor/256x256/apps/imgpdfsquisher.png"

  # (opzionale) copia anche una dimensione 512 se la hai:
  if [[ -f "assets/logo/logo-512.png" ]]; then
    install -d "$pkgdir/usr/share/icons/hicolor/512x512/apps"
    install -m 644 "assets/logo/logo-512.png" "$pkgdir/usr/share/icons/hicolor/512x512/apps/imgpdfsquisher.png"
  fi
}
